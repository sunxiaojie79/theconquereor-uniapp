# 高德地图集成指南

征途挑战小程序使用高德地图提供地图服务和导航功能。按照以下步骤完成配置：

## 1. 申请高德地图API Key

### 步骤一：注册高德开放平台账号
1. 访问 [高德开放平台](https://lbs.amap.com/)
2. 点击"注册"创建账号，或使用现有账号登录
3. 完成开发者认证（个人或企业认证）

### 步骤二：创建应用获取Key
1. 登录后进入"控制台" > "应用管理"
2. 点击"创建新应用"
3. 填写应用信息：
   - 应用名称：征途挑战小程序
   - 应用类型：微信小程序
4. 点击"提交"创建应用

### 步骤三：添加Key
1. 在应用列表中找到刚创建的应用
2. 点击"添加Key"
3. 配置Key信息：
   - Key名称：征途挑战地图服务
   - 服务平台：微信小程序
   - PackageName：你的小程序AppID
4. 绑定服务：选择需要的地图服务
   - ✅ 地图
   - ✅ 定位
   - ✅ 搜索
   - ✅ 路线规划
   - ✅ 地理编码
5. 点击"提交"生成Key

## 2. 配置微信小程序

### 步骤一：配置服务器域名
在微信小程序管理后台设置合法域名：
1. 登录 [微信公众平台](https://mp.weixin.qq.com/)
2. 进入"开发" > "开发管理" > "开发设置"
3. 在"服务器域名"中添加：

**request合法域名：**
```
https://restapi.amap.com
https://webapi.amap.com
```

**downloadFile合法域名：**
```
https://webapi.amap.com
```

### 步骤二：添加高德地图插件
1. 在微信开发者工具中打开项目
2. 修改 `app.json` 添加插件配置：

```json
{
  "plugins": {
    "myPlugin": {
      "version": "2.0.0",
      "provider": "wx06af10f87ee91d11"
    }
  }
}
```

## 3. 配置项目

### 步骤一：更新配置文件
编辑 `config/amap.js` 文件，将 `YOUR_AMAP_KEY_HERE` 替换为你的API Key：

```javascript
export const amapConfig = {
  key: 'your_actual_api_key_here', // 替换为实际的Key
  // ... 其他配置
}
```

### 步骤二：验证配置
运行项目后，检查控制台是否有以下信息：
- ✅ 没有"请配置高德地图API Key"的警告
- ✅ 地图正常加载显示
- ✅ 定位功能正常工作

## 4. 功能说明

### 地图详情页面功能
- 🗺️ **路线地图显示**：显示挑战路线的完整地图
- 📍 **里程碑标记**：标注重要的检查点和里程碑
- 📊 **进度可视化**：实时显示用户完成进度
- 🧭 **地图控件**：定位、缩放、图层切换
- 🎯 **点击交互**：点击标记查看详细信息
- 🔗 **导航集成**：直接跳转到高德地图进行导航

### 支持的地图功能
- **基础地图**：标准地图、卫星图
- **定位服务**：获取用户当前位置
- **路线绘制**：显示挑战路线轨迹
- **POI搜索**：搜索兴趣点
- **地理编码**：地址与坐标转换

## 5. 常见问题

### Q: 地图无法显示？
A: 检查以下项目：
1. API Key是否正确配置
2. 服务器域名是否已添加到白名单
3. 网络连接是否正常
4. 是否开启了定位权限

### Q: 定位失败？
A: 确保：
1. 用户已授权定位权限
2. 设备定位服务已开启
3. 在真机上测试（开发工具模拟器定位可能不准确）

### Q: 导航功能无法使用？
A: 检查：
1. 目标设备是否安装了高德地图APP
2. URL Scheme是否正确
3. 参数格式是否符合要求

## 6. 进阶配置

### 自定义地图样式
1. 在高德控制台创建自定义地图样式
2. 获取样式ID
3. 在配置文件中更新 `mapStyle.custom`

### 性能优化建议
- 合理设置地图缩放级别
- 减少不必要的标记点
- 使用地图事件节流
- 及时销毁地图实例

## 7. 技术支持

- 📖 [高德地图微信小程序开发文档](https://lbs.amap.com/api/wx/gettingstarted)
- 🎯 [高德开放平台控制台](https://console.amap.com/)
- 💬 [技术支持论坛](https://lbs.amap.com/dev/support)

---

配置完成后，重新编译运行项目，地图功能应该能够正常工作。如遇问题，请参考常见问题部分或联系技术支持。 